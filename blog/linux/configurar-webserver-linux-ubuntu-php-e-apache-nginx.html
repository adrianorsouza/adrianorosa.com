<!DOCTYPE html>
<html lang="pt-br">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Como configurar um servidor web Linux Ubuntu | Adriano Rosa</title>
    <meta name="description" content="Este artigo pode ser considerado a continuação de como criar uma instancia na Amazon AWS escrito recentemente onde falo sobre a instalação do Ubuntu Server na nuvem. Porém os métodos descritos neste post podem ser aplicados em qualquer instalação do Linux Ubuntu Server versão a partir da 12.10 até a mais recente. Foram longas horas de pesquisas e testes para chegar há um conceito básico de configuração e dos principais requisitos de segurança para um servidor web, este guia foi elaborado para efeito de estudos e testes de novas aplicações e pode ser aplicado no mundo real. Por favor, sinta-se livre em colaborar com este material se de alguma forma possua alguma informação relevante que possa ser atribuída à este artigo.
">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Adriano Rosa">
    <link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
    <link rel="icon" href="/images/favicon.png">
    <link rel="stylesheet" href="/assets/css/application-style.css"/>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600">
    <!--[if IE]><script src="/assets/js/ie10-viewport.js"></script><![endif]-->
    <!--[if lt IE 9]>
      <script src="/assets/js/html5shiv.min.js"></script>
      <script src="/assets/js/respond.min.js"></script>
    <![endif]-->
    <link rel='prev' href='http://adrianorosa.com/blog/aws/criar-instancia-na-amazon-aws.html' />
    <link rel='next' href='http://adrianorosa.com/blog/jquery/jquery-keycode-tabela-de-referencia.html' />
    <link rel="canonical" href="http://adrianorosa.com/blog/linux/configurar-webserver-linux-ubuntu-php-e-apache-nginx.html" />
    <link rel="alternate" type="application/rss+xml" title="Adriano Rosa &raquo; Feed" href="http://adrianorosa.com/feed.xml" />
    <!-- OpenGraphic tags -->
    <meta property="og:locale" content="pt-br" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Como configurar um servidor web Linux Ubuntu" />
    <meta property="og:description" content="Este artigo pode ser considerado a continuação de como criar uma instancia na Amazon AWS escrito recentemente onde falo sobre a instalação do Ubuntu Server na nuvem. Porém os métodos descritos neste post podem ser aplicados em qualquer instalação do Linux Ubuntu Server versão a partir da 12.10 até a mais recente. Foram longas horas de pesquisas e testes para chegar há um conceito básico de configuração e dos principais requisitos de segurança para um servidor web, este guia foi elaborado para efeito de estudos e testes de novas aplicações e pode ser aplicado no mundo real. Por favor, sinta-se livre em colaborar com este material se de alguma forma possua alguma informação relevante que possa ser atribuída à este artigo.
" />
    <meta property="og:url" content="http://adrianorosa.com/blog/linux/configurar-webserver-linux-ubuntu-php-e-apache-nginx.html" />
    <meta property="og:site_name" content="Adriano Rosa" />
    <meta property="article:author" content="Adriano Rosa" />
    <meta property="og:image" content="http://adrianorosa.com/images/logo.png" />
  </head>
  <body>
    <div class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/" title="Adriano Rosa">adriano<strong>rosa</strong></a>
        </div>
        <nav class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/" title="Home">Home</a></li>
            <li><a href="/about/" title="About">Sobre</a></li>
            <li class="active"><a href="/blog/" title="Artigos no Blog">Blog</a></li>
          </ul>
        </nav><!--/.nav-collapse -->
      </div>
    </div>
    <!-- /.header -->
    <div class="blog-header">
      <div class="container">
          <h1 class="blog-title">
                  Linux
          </h1>
      </div>
    </div>
    <div class="container">
      <div class="row">
          <div class="col-sm-8 content">
<article class="post">
  <header class="post-header">
<h1 class="post-title">Como configurar um servidor web Linux Ubuntu</h1>
<p class="post-meta">
<time class="post-time" datetime="2014-09-03"><i class="ico ico-clock"></i> 03 Sep 2014</time> &mdash;
<span class="post-category">
<a href="/blog/category/linux" title="Artigos na Categoria Linux">Linux</a>
</span> &mdash;
<i class="ico ico-comment"></i> <a href="http://adrianorosa.com/blog/linux/configurar-webserver-linux-ubuntu-php-e-apache-nginx.html#disqus_thread" title="Comentário">0 Comentário</a>
</p>
</header>
  <section class="post-content">
    <p>Este artigo pode ser considerado a continuação de <a href="/blog/aws/criar-instancia-na-amazon-aws.html" title="Como Criar uma instancia na Amazon AWS">como criar uma instancia na Amazon AWS</a> escrito recentemente onde falo sobre a instalação do Ubuntu Server na nuvem. Porém os métodos descritos neste post podem ser aplicados em qualquer instalação do Linux Ubuntu Server versão a partir da 12.10 até a mais recente. Foram longas horas de pesquisas e testes para chegar há um conceito básico de configuração e dos principais requisitos de segurança para um servidor web, este guia foi elaborado para efeito de estudos e testes de novas aplicações e pode ser aplicado no mundo real. Por favor, sinta-se livre em colaborar com este material se de alguma forma possua alguma informação relevante que possa ser atribuída à este artigo.</p>
<h2 id="Índice">Índice</h2>
<!-- MarkdownTOC depth=3 autolink=true bracket=round -->
<ul>
<li><a href="#1.-introdu%C3%A7%C3%A3o">1. Introdução</a></li>
<li><a href="#2.-requisitos">2. Requisitos</a></li>
<li><a href="#3.-atualizar-o-sistema">3. Atualizar o sistema</a>
<ul>
<li><a href="#3.1-executar-a-atualiza%C3%A7%C3%A3o-do-sistema">3.1 Executar a atualização do sistema</a></li>
<li><a href="#3.2-atualizar-timezone-e-locale">3.2 Atualizar Timezone e Locale</a></li>
</ul></li>
<li><a href="#4.-configura%C3%A7%C3%B5es-de-seguran%C3%A7a">4. Configurações de Segurança</a>
<ul>
<li><a href="#4.1-firewall---ufw">4.1 Firewall - UFW</a></li>
<li><a href="#4.2-habilitar-logs-do-firewall">4.2 Habilitar Logs do Firewall</a></li>
<li><a href="#4.3-restringir-configura%C3%A7%C3%B5es-de-rede">4.3 Restringir configurações de rede</a></li>
<li><a href="#4.4-prevenir-ip-spoofing">4.4 Prevenir IP Spoofing</a></li>
<li><a href="#4.5-secure-shared-memory">4.5 Secure shared memory</a></li>
<li><a href="#4.6-prevenir-fork-bomb-limitando-user-process">4.6 Prevenir Fork Bomb limitando user process</a></li>
<li><a href="#4.7-configura%C3%A7%C3%B5es-de-seguran%C3%A7a-do-apache">4.7 Configurações de Segurança do Apache</a></li>
<li><a href="#4.8-configura%C3%A7%C3%B5es-de-seguran%C3%A7a-do-nginx">4.8 Configurações de Segurança do Nginx</a></li>
</ul></li>
<li><a href="#5.-ssh-security">5. SSH Security</a>
<ul>
<li><a href="#5.1-desabilitar-ssh-root-login">5.1 Desabilitar SSH Root Login</a></li>
<li><a href="#5.2-desabilitar-port-forwarding">5.2 Desabilitar Port Forwarding</a></li>
<li><a href="#5.3-definir-usu%C3%A1rios-que-podem-conectar-via-ssh">5.3 Definir usuários que podem conectar via SSH</a></li>
<li><a href="#5.4-use-sftp-inv%C3%A9s-de-ftp">5.4 Use SFTP invés de FTP</a></li>
<li><a href="#5.5-ssh-welcome-banner">5.5 SSH Welcome Banner</a></li>
</ul></li>
<li><a href="#6.-monitorar-o-sistema-e-alertas">6. Monitorar o Sistema e Alertas</a>
<ul>
<li><a href="#6.1-configurar-o-monit">6.1 Configurar o Monit</a></li>
</ul></li>
<li><a href="#7.-instalar-htop">7. Instalar HTOP</a></li>
</ul>
<!-- /MarkdownTOC -->
<h2 id="1.-introdução">1. Introdução</h2>
<p>Este artigo é um guia baseado em várias horas de pesquisa em fóruns, sites e na própria documentação do <a href="https://help.ubuntu.com/" title="Documentação Ubuntu">Linux Ubuntu</a>. Em forma de agradecimento para aqueles que contribuem para comunidade open source no fim desta página deixo uma referência de seus respectivos links para que também possa ser útil para você que deseja se aprofundar nesse assunto.</p>
<h2 id="2.-requisitos">2. Requisitos</h2>
<ul>
<li><a href="/blog/aws/criar-instancia-na-amazon-aws.html" title="Como Criar uma instancia na Amazon AWS">Linux Ubuntu Server 13.10 LTS</a> ou posterior instalado.</li>
<li>Opcional <a href="/blog/nginx/instalar-versao-recente-nginx-no-linux-ubuntu.html">Nginx (LEMP stack)</a> instalado</li>
<li>Opcional <a href="#todo">Apache (LAMP stack)</a> instalado ou ambos LEMP e LAMP stack.</li>
</ul>
<h2 id="3.-atualizar-o-sistema">3. Atualizar o sistema</h2>
<p>Primeira coisa após uma recente instalação do Ubuntu é atualizar sua lista de pacotes e pacotes já instalados, mesmo sendo uma nova instalação pode conter alguns programas desatualizadas ou algumas correções de bug não incluída na compilação do sistema.</p>
<h3 id="3.1-executar-a-atualização-do-sistema">3.1 Executar a atualização do sistema</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo apt-get update
sudo apt-get upgrade
sudo apt-get dist-upgrade
</code></pre></div>
<p>Caso deseja fazer o upgrade do sistema por ex: da versão 13.10 LTS para 14.10 LTS:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo do-release-upgrade 
</code></pre></div>
<h3 id="3.2-atualizar-timezone-e-locale">3.2 Atualizar Timezone e Locale</h3>
<p>Quando instalamos um novo servidor web é fundamental verificar se está sincronizado com a data e fuso horário local ou definido pela sua aplicação.</p>
<p>O Timezone define seu fuso horário, Locale define as traduções de strings e formatos data, numérico, moeda e etc. de acordo com sua região.</p>
<p>Em caso de instancias criada na Amazon AWS EC2 o Timezone do servidor não estará definido, é necessário configurar o Timezone e locale conforme os seguintes passos:</p>
<p>Alterar o Timezone e Locale:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo dpkg-reconfigure tzdata 
</code></pre></div>
<p>Para verificar o atual locale execute:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">locale
</code></pre></div>
<p>Para visualizar o locale definido no sistema:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">locale -a
</code></pre></div>
<p>Caso não tenha o <code>pt_BR.UTF8</code> definido no locale é possível instalar o pacote:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo locale-gen pt_BR.UTF-8
</code></pre></div>
<p>Se sua configuração não foi feita corretamente e esta recebendo a seguinte mensagem de erro: </p>
<pre><span class="text-danger">FIX ERROR: Sorry, command-not-found has crashed! Please file a bug report at: http://askubuntu.com/questions/205378/unsupported-locale-setting-fault-by-command-not-found</span></pre>
<p>Solução edite o arquivo de configuração <code>/var/lib/locales/supported.d/local</code>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo nano /var/lib/locales/supported.d/local
</code></pre></div>
<p>E adicione as seguintes linhas:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">pt_BR.UTF-8 UTF-8
en_US.UTF-8 UTF-8
</code></pre></div>
<p>Ou abra o arquivo: <code>/etc/default/locale</code> e defina manualmente os parâmetros que causam erros:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">LANG=&quot;pt_BR.UTF-8&quot;
LANGUAGE=&quot;pt_BR.UTF-8&quot;
LC_CTYPE=&quot;pt_BR.UTF-8&quot;
LC_ALL=&quot;pt_BR.UTF-8&quot;
</code></pre></div>
<p>Se o problema persistir execute os seguintes comandos:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">export LANGUAGE=pt_BR.UTF-8
export LANG=pt_BR.UTF-8
export LC_ALL=pt_BR.UTF-8
export LC_CTYPE=pt_BR.UTF-8
sudo locale-gen pt_BR.UTF-8
</code></pre></div>
<p>Por Fim Reconfigure o Locale:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo dpkg-reconfigure locales
</code></pre></div>
<h2 id="4.-configurações-de-segurança">4. Configurações de Segurança</h2>
<h3 id="4.1-firewall---ufw">4.1 Firewall - UFW</h3>
<p>Se seu servidor está na Amazon AWS ele está protegido por um <a href="http://en.wikipedia.org/wiki/Application_firewall#Network-based_application_firewalls">Network Firewall</a>, caso tenha definido um <strong>Security Group</strong>, porém podemos adicionar mais uma camada de segurança usando o UFW (<em>Uncomplicated Firewall</em>) um <a href="http://en.wikipedia.org/wiki/Application_firewall#Host-based_application_firewalls">Host-based Firewall</a> que já vem instalado no Ubuntu, mas desativado.</p>
<p>Antes de habilitar UFW Firewall é necessário adicionar as regras de entrada para evitar que você fique trancado do lado de fora e não tenha qualquer tipo acesso ao servidor.</p>
<p>As principais portas de acesso que precisam ser adicionadas são TCP 22 <code>SSH</code> e 80 <code>HTTP</code>. Para liberar essas portas execute o seguinte comando:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo ufw allow 22
sudo ufw allow 80
</code></pre></div>
<p>Para permitir acesso ao servidor de um especifico endereço IP:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo ufw allow proto tcp from 1234.456.789.0 to any port 22 
</code></pre></div>
<p>Então poderá ativar o UFW Firewall com o comando:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo ufw enable
</code></pre></div>
<p>Para verificar o status do UFW use:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo ufw status verbose
</code></pre></div>
<p>Para deletar uma regra no UFW:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo ufw delete deny 80/tcp 
</code></pre></div>
<h3 id="4.2-habilitar-logs-do-firewall">4.2 Habilitar Logs do Firewall</h3>
<p>Se você estiver usando o ufw, você pode habilitar logs com o seguinte comando:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo ufw logging on
</code></pre></div>
<h3 id="4.3-restringir-configurações-de-rede">4.3 Restringir configurações de rede</h3>
<p>O Kernel do Linux permite alterar vários parâmetros no system runtime, o arquivo <code>/etc/sysctl.conf</code> pode ser modificado para deixar ainda mais restrito suas configurações de rede como também prevenir ataques como <strong><a href="http://en.wikipedia.org/wiki/SYN_flood">Syn Flood</a></strong>. Não vou detalhar todos os itens aqui, mas o arquivo é bem comentado, eu recomendo que antes de editar leia seu manual.</p>
<p>Agora, abra o arquivo <code>/etc/sysctl.conf</code> </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo nano /etc/sysctl.conf
</code></pre></div>
<p>E altere conteúdo desse arquivo para o seguinte:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_max_syn_backlog = 2048
net.ipv4.tcp_synack_retries = 2
net.ipv4.tcp_syn_retries = 5
net.ipv4.ip_forward = 0
net.ipv4.icmp_echo_ignore_all = 1
net.ipv4.conf.all.accept_redirects = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv6.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv6.conf.default.accept_source_route = 0
net.ipv4.conf.all.log_martians = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1
net.ipv6.conf.default.router_solicitations = 0
net.ipv6.conf.default.accept_ra_rtr_pref = 0
net.ipv6.conf.default.accept_ra_pinfo = 0
net.ipv6.conf.default.accept_ra_defrtr = 0
</code></pre></div>
<p>após alterar o arquivo faça reload:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo sysctl -p
</code></pre></div>
<h3 id="4.4-prevenir-ip-spoofing">4.4 Prevenir IP Spoofing</h3>
<p>Edite o arquivo <code>/etc/host.conf</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo nano /etc/host.conf
</code></pre></div>
<p>Adicione as seguintes linhas:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">order bind,hosts
nospoof on
</code></pre></div>
<h3 id="4.5-secure-shared-memory">4.5 Secure shared memory</h3>
<p>Por padrão, <code>/run/shm</code> é montado com leitura/gravação, com permissão para executar programas. Nos últimos anos, muitas listas de discussão de segurança identificaram diversos exploits onde <code>/run/shm</code> é usado em um ataque contra a serviços, como o httpd. <a href="https://help.ubuntu.com/community/StricterDefaults#Shared_Memory">Para mais detalhes</a>.</p>
<p>Edite o arquivo <code>/etc/fstab</code> e adicione a seguinte linha:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">none    /run/shm    tmpfs   rw,noexec,nosuid,nodev  0 0
</code></pre></div>
<h3 id="4.6-prevenir-fork-bomb-limitando-user-process">4.6 Prevenir Fork Bomb limitando user process</h3>
<p>Edit o arquivo: <code>/etc/security/limits.conf</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo nano /etc/security/limits.conf
</code></pre></div>
<p>E adicione a seguinte linha no fim do arquivo:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">*                hard    nproc           800
</code></pre></div>
<h3 id="4.7-configurações-de-segurança-do-apache">4.7 Configurações de Segurança do Apache</h3>
<p>Se possui o Apache (LAMP stack) instalado no seu servidor siga as instruções do artigo <a href="#todo">como instalar e configurar o Apache</a> para adicionar uma camada extra de segurança no seu servidor web.</p>
<h3 id="4.8-configurações-de-segurança-do-nginx">4.8 Configurações de Segurança do Nginx</h3>
<p>Se possui o Nginx (LEMP stack) instalado no seu servidor siga as instruções do artigo <a href="/blog/nginx/instalar-versao-recente-nginx-no-linux-ubuntu.html">como instalar e configurar o Nginx</a> para adicionar uma camada extra de segurança no seu servidor web.</p>
<h2 id="5.-ssh-security">5. SSH Security</h2>
<p>SSH é um meio seguro para conexão com seu servidor remoto, embora seja muito seguro alguns tweaks na configuração do <code>sshd</code> pode tornar ainda mais restrito, para isso é necessário abrir o arquivo <code>/etc/ssh/sshd_config</code>. E neste arquivo vamos alterar alguns parâmetros e se esses parâmetros não existirem iremos adicioná-lo.</p>
<h3 id="5.1-desabilitar-ssh-root-login">5.1 Desabilitar SSH Root Login</h3>
<p>Geralmente o Ubuntu não permite acesso direto com o usuário <code>root</code>, mas caso tenha definido uma senha para usuário <code>root</code> isso pode ser um potencial risco de segurança. Para desabilitar login com <code>root</code> abra o o arquivo <code>/etc/ssh/sshd_config</code>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo nano /etc/ssh/sshd_config
</code></pre></div>
<p>Aproveite e desabilite também <strong><a href="https://help.ubuntu.com/community/SSH/OpenSSH/Configuring#Disable_Password_Authentication">Password Authentication</a></strong> e <strong><a href="https://help.ubuntu.com/community/StricterDefaults#SSH_Login_Grace_Time">LoginGraceTime</a></strong> encontre os parâmetros a seguir e defina conforme abaixo:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">LoginGraceTime 20
PasswordAuthentication no
PermitRootLogin no
</code></pre></div>
<h3 id="5.2-desabilitar-port-forwarding">5.2 Desabilitar Port Forwarding</h3>
<p>Se os parâmetros abaixo não existirem adicione no fim do arquivo para desabilitar SSH Port Forwarding:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">AllowTcpForwarding no
X11Forwarding no
</code></pre></div>
<h3 id="5.3-definir-usuários-que-podem-conectar-via-ssh">5.3 Definir usuários que podem conectar via SSH</h3>
<p>É possível definir usuários ou grupos específicos que podem ter ou não acesso via SSH.<br>
Para permitir ou bloquear usuários SSH:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">AllowUsers username
DenyUsers username
</code></pre></div>
<p>Para permitir ou bloquear groups SSH:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">AllowGroups groupname
DenyGroups groupname
</code></pre></div>
<h3 id="5.4-use-sftp-invés-de-ftp">5.4 Use SFTP invés de FTP</h3>
<p>Suponha que você queira dar alguns usuários ou grupos a capacidade de upload e download de arquivos de seus diretórios home (ou ~/web), mas não uma conta shell completo com permissão de conexão SSH. No Ubuntu isso é simples de conseguir com componente SFTP do OpenSSH.</p>
<p>Primeiro localize a seguinte linha no arquivo <code>/etc/ssh/sshd_config</code>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Subsystem sftp /usr/lib/openssh/sftp-server
</code></pre></div>
<p>E altera para:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Subsystem sftp internal-sftp
</code></pre></div>
<p>Agora, adicione as linhas como esta abaixo no fim do arquivo <code>/etc/ssh/sshd_config</code>.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Match User username
  ChrootDirectory %h
  X11Forwarding no
  AllowAgentForwarding no
  AllowTcpForwarding no
  ForceCommand internal-sftp
</code></pre></div>
<p>Para definir essa regra para mais de um usuário, use grupos e altere a linha <code>Match User username</code> para o nome do grupo que criou para usuários <code>SFTP</code> como abaixo:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Match Group groupname
</code></pre></div>
<p>Também, defina o shell para <code>/usr/bin/false</code> para previnir normal ssh login:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo usermod -s /usr/bin/false username
</code></pre></div>
<p class="text-warning">
<strong>Importante:</strong> A diretório definido no parâmetro <code>ChrootDirectory</code> deve pertencer ao usuário <code>root</code> se este diretório é a própria pasta home do usuário, então altere as permissões:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo chown root:root /home/username
</code></pre></div>
<h3 id="5.5-ssh-welcome-banner">5.5 SSH Welcome Banner</h3>
<p>Se desejar é possível adicionar um banner de boas vindas para ser exibido quando usuários SSH se conectarem, para isso no arquivo <code>/etc/ssh/sshd_config</code> remova <code>#</code> na linha <code>#Banner /etc/issue.net</code>.</p>
<p>Logo após, edite o arquivo <code>/etc/issue.net</code> para definir o banner que será exibido quando usuários se conectarem via SSH.</p>
<p>Após todas as mudanças no arquivo <code>/etc/ssh/sshd_config</code> lembre-se de reiniciar o ssh daemon com o seguinte comando:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo service ssh restart
</code></pre></div>
<h2 id="6.-monitorar-o-sistema-e-alertas">6. Monitorar o Sistema e Alertas</h2>
<p>Mesmo as melhores configurações de servidores podem ter problemas. Para monitorar os recursos do seu servidor Linux eu recomendo instalar e configurar o <a href="http://mmonit.com/monit/">Monit</a>. Monit permite monitorar eventos e processos, muito útil para checar sobrecarga ou paralisação de algum recurso.</p>
<p>Para instalar o Monit:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo apt-get install monit
</code></pre></div>
<p>Para habilitar Monit on startup edite o arquivo <code>/etc/default/monit</code>: </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo nano /etc/default/monit
</code></pre></div>
<p>E altere o parâmetro <code>START</code> para <code>yes</code> ou <code>1</code> da seguinte maneira: </p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># Set START to yes to start the monit
START=yes
</code></pre></div>
<h3 id="6.1-configurar-o-monit">6.1 Configurar o Monit</h3>
<p>O arquivo de configuração do Monit fica localizado em <code>/etc/monit/monitrc</code>. Ao abrir esse arquivo pode parecer inicialmente bem complexo para entender seus parâmetros, mas o que precisa ser feito e adicionar entradas dos processos que deseja monitorar por ex: apache, mysql, ssh e definir seus limites e alertas caso tenha alguma falha e finalmente definir um endereço de email para onde será enviado alertas em caso de falha ou overload. Bom eu recomendo que leia a <a href="http://mmonit.com/monit/#documentation">documentação</a> caso tenha alguma dúvida.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo nano /etc/monit/monitrc
</code></pre></div>
<p>Depois de configurar o Monit pode testar as configurações: </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo monit -t
</code></pre></div>
<p>Após configurar o Monit para habilitar/desabilitar use os seguintes comandos:</p>
<p>Habilitar:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo /etc/init.d/monit start
</code></pre></div>
<p>Desabilitar:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo /etc/init.d/monit stop
</code></pre></div>
<h2 id="7.-instalar-htop">7. Instalar HTOP</h2>
<p><a href="http://hisham.hm/htop/">HTOP</a> é um programa similar ao comando <code>top</code> mas de forma interativa você pode visualizar processos no Linux. Para instalar execute o comando:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo apt-get install htop
</code></pre></div>
<hr>
<h4 id="referência">Referência</h4>
<p><a href="https://help.ubuntu.com/community/StricterDefaults">https://help.ubuntu.com/community/StricterDefaults</a><br>
<a href="http://askubuntu.com/questions/205378/unsupported-locale-setting-fault-by-command-not-found">http://askubuntu.com/questions/205378/unsupported-locale-setting-fault-by-command-not-found</a><br>
<a href="https://help.ubuntu.com/community/SSH/OpenSSH/">https://help.ubuntu.com/community/SSH/OpenSSH/</a><br>
<a href="https://help.ubuntu.com/community/UFW">https://help.ubuntu.com/community/UFW</a><br>
<a href="http://hisham.hm/htop/">http://hisham.hm/htop/</a><br>
<a href="http://mmonit.com/monit/#documentation">http://mmonit.com/monit/#documentation</a><br>
<a href="https://www.thefanclub.co.za/how-to/how-secure-ubuntu-1204-lts-server-part-1-basics">https://www.thefanclub.co.za/how-to/how-secure-ubuntu-1204-lts-server-part-1-basics</a><br>
<a href="http://blog.chriskankiewicz.com/setting-up-an-ubuntu-web-server.html">http://blog.chriskankiewicz.com/setting-up-an-ubuntu-web-server.html</a>  </p>
  </section><!-- ./post-content -->
  <hr>
  <section class="post-related">
    <h3>Post relacionados</h3>
    <ol class="list-unstyled">
      <li><time class="post-time" datetime="2014-09-01">01 Sep 2014</time> &mdash; <a href="/blog/aws/criar-instancia-na-amazon-aws.html" title="Criar uma instancia na Amazon AWS">Criar uma instancia na Amazon AWS</a></li>
      <li><time class="post-time" datetime="2008-11-10">10 Nov 2008</time> &mdash; <a href="/blog/wordpress/como-instalar-o-wordpress.html" title="Como instalar o WordPress">Como instalar o WordPress</a></li>
      <li><time class="post-time" datetime="2014-11-28">28 Nov 2014</time> &mdash; <a href="/blog/nginx/instalar-versao-recente-nginx-no-linux-ubuntu.html" title="Instalar versão mais recente do Nginx no Linux Ubuntu">Instalar versão mais recente do Nginx no Linux Ubuntu</a></li>
    </ol>
  </section><!-- ./post-related -->
  <hr>
  <section class="post-navigation">
    <ul class="pager">
      <li class="prev"><a href="/blog/aws/criar-instancia-na-amazon-aws.html" title="Criar uma instancia na Amazon AWS">&lsaquo; anterior</a></li>
      <li class="next"><a href="/blog/jquery/jquery-keycode-tabela-de-referencia.html" title="jQuery KeyCode Tabela de referência">próximo &rsaquo;</a></li>
    </ul>
  </section><!-- ./post-navigation -->
  <section class="post-comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'adrianorosa';
        var disqus_title = 'Como configurar um servidor web Linux Ubuntu';
        var disqus_url = 'http://adrianorosa.com/blog/linux/configurar-webserver-linux-ubuntu-php-e-apache-nginx.html';
        var disqus_identifier = '';
        // var disqus_developer = 1; // developer mode is on
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
<script type="text/javascript">
  var disqus_shortname = 'adrianorosa';
  (function () {
  var s = document.createElement('script'); s.async = true;
  s.type = 'text/javascript';
  s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>
</article>
          </div><!-- /.content -->
<aside class="col-sm-3 col-sm-offset-1 blog-sidebar">
  <div class="sidebar-module sidebar-module-inset author-brief">
    <h4><img src="https://secure.gravatar.com/avatar/ad6facb479066db3b8007443ce79fcdd?s=100" alt="" class="img-circle" width="50" height="50"> Sobre o Adriano</h4>
    <p>
      Adriano é Analista Programador Backend/Frontend por mais de uma década. Apaixonado pelo o que faz!
      Ao longo de todos esses anos se especializou em diversas tecnologias de desenvolvimento web,
      hoje é considerado FullStack Developer.
    </p>
    <hr>
    <ul>
      <li><a href="https://github.com/adrianorsouza" class="_blank" title="veja meu perfil no Github"><i class="ico ico-github"></i> <span class="hide-text">GitHub</span></a></li>
      <li><a href="https://twitter.com/adrianorosa" class="_blank" title="veja meu perfil no Twitter"><i class="ico ico-twitter"></i> <span class="hide-text">Twitter</span></a></li>
      <li><a href="https://www.facebook.com/adrianorosadesouza" class="_blank" title="veja meu perfil no Facebook"><i class="ico ico-facebook"></i> <span class="hide-text">Facebook</span></a></li>
      <li><a href="/feed.xml" class="_blank" title="acompanhe as atualizações do blog"><i class="ico ico-rss"></i> <span class="hide-text">Rss</span></a></li>
    </ul>
  </div>
  <div class="sidebar-module">
    <h4>Categorias</h4>
    <ol class="list-unstyled">
      <li><a href="/blog/category/asp" title="ASP">ASP</a></li>
      <li><a href="/blog/category/aws" title="AWS">AWS</a></li>
      <li><a href="/blog/category/banco-de-dados" title="Banco de Dados">Banco de Dados</a></li>
      <li><a href="/blog/category/css" title="CSS">CSS</a></li>
      <li><a href="/blog/category/composer" title="Composer">Composer</a></li>
      <li><a href="/blog/category/google" title="Google">Google</a></li>
      <li><a href="/blog/category/laravel" title="Laravel">Laravel</a></li>
      <li class="active"><a href="/blog/category/linux" title="Linux">Linux</a></li>
      <li><a href="/blog/category/nginx" title="Nginx">Nginx</a></li>
      <li><a href="/blog/category/noticias" title="Noticias">Noticias</a></li>
      <li><a href="/blog/category/ruby" title="Ruby">Ruby</a></li>
      <li><a href="/blog/category/seguranca" title="Segurança">Segurança</a></li>
      <li><a href="/blog/category/sublime-text" title="Sublime Text">Sublime Text</a></li>
      <li><a href="/blog/category/tecnologia" title="Tecnologia">Tecnologia</a></li>
      <li><a href="/blog/category/webserver" title="Webserver">Webserver</a></li>
      <li><a href="/blog/category/wordpress" title="Wordpress">Wordpress</a></li>
      <li><a href="/blog/category/jquery" title="jQuery">jQuery</a></li>
    </ol>
  </div>
</aside><!-- /.blog-sidebar -->
      </div><!-- /.row -->
    </div><!-- /.container -->
    <footer class="blog-footer">
      <p>Adriano Rosa - Web Developer</p>
      <ol class="list-unstyled">
        <li><a href="https://github.com/adrianorsouza" class="_blank"><i class="ico ico-github"></i> GitHub</a></li>
        <li><a href="https://twitter.com/adrianorosa" class="_blank"><i class="ico ico-twitter"></i> Twitter</a></li>
        <li><a href="https://www.facebook.com/adrianorosadesouza" class="_blank"><i class="ico ico-facebook"></i> Facebook</a></li>
      </ol>
      <p><small>This blog is proudly built with <a href="http://jekyllrb.com/" class="_blank">Jekyll</a> | &copy; 2005 &mdash; 2017</small></p>
    </footer>
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/main.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-5189486-5', 'auto');
  ga('send', 'pageview');
</script>
<a href="#top" class="btn to_top" title="rolar a página"><i class="ico ico-arrow-up"></i></a>

  </body>
</html>
